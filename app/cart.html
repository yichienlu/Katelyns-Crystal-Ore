---
title: 購物車
layout: ./app/layout.ejs
engine: ejs
current: cart
---

<section class=" px-3 py-10 lg:py-20">
  <div class="container mx-auto">
    <h3 class="">我的購物車</h3>
    <p id="cartEmpty">
      購物車沒有東西，<a href="design.html" class="">去訂製專屬飾品</a>
    </p>
    <div id="cartTable" class="">
      <table class="bg-red-200 mx-auto mb-5">
        <thead>
          <tr>
            <th width="5%"></th>
            <th width="60%">品項</th>
            <th width="10%">手圍</th>
            <th width="15%">金額</th>
            <th width="10%"></th>
          </tr>
        </thead>
        <tbody id="cartList">
        </tbody>
        <tfoot>
          <tr>
            <td colspan="2">
              <p>總金額</p>
            </td>
            <td>

            </td>
            <td id="cartTotalPrice"></td>
            <td></td>

        </tr>
        </tfoot>
          
      </table>
      <a href="#" class="" onclick="clearCart()">刪除所有品項</a>
  </div>
  </div>
</section>

<section class="px-3 py-10 lg:py-20" id="orderInfo">
  <div class="container mx-auto">
    <h3 class="section-title">填寫預訂資料</h3>
    <form action="" class="sm:w-3/4 md:w-2/3 lg:w-1/2 mx-auto">
      <div class="mb-3">
          <label for="customerName" class="mb-1">姓名</label>
          <div class="">
              <input type="text" class="w-full" id="customerName" placeholder="請輸入姓名" name="姓名">
              <p class=" text-red-500" data-message="姓名"></p>
          </div>
      </div>
      <div class="mb-3">
          <label for="customerPhone" class="mb-1">電話</label>
          <div class="">
              <input type="tel" class="w-full" id="customerPhone" placeholder="請輸入電話" name="電話">
              <p class=" text-red-500" data-message="電話"></p>
          </div>
      </div>
      <div class="mb-3">
          <label for="customerEmail" class="mb-1">Email</label>
          <div class="">
              <input type="email" class="w-full" id="customerEmail" placeholder="請輸入 Email" name="Email">
              <p class=" text-red-500" data-message="Email"></p>
          </div>
      </div>
      <div class="mb-3">
          <label for="customerAddress" class="mb-1">寄送地址</label>
          <div class="">
              <input type="text" class="w-full" id="customerAddress" placeholder="請輸入寄送地址" name="寄送地址">
              <p class="text-red-500" data-message="寄送地址"></p>
          </div>
      </div>
      <div class="mb-3">
          <label for="tradeMethod" class="mb-1">交易方式</label>
          <div class="">
              <select id="tradeMethod" class="w-full" name="交易方式">
                  <option value="ATM" selected>ATM</option>
                  <option value="信用卡">信用卡</option>
                  <option value="超商付款">超商付款</option>
              </select>
          </div>
      </div>
      <input type="submit" value="送出預訂資料" class="btn-primary w-full" onclick="addOrder()">
  </form>

  </div>

</section>

<script>


  let cart;
  
  function renderCartData(){
    if(JSON.parse(localStorage.getItem("cart"))){   
      document.querySelector("#cartTable").classList.remove("hidden")
      document.querySelector("#cartEmpty").classList.add("hidden")
      
      cart = JSON.parse(localStorage.getItem("cart"));
      let cartTotalPrice=0;
      let str="";
      cart.forEach(function(item,index){      
        str += `
          <tr>
            <td>${index+1}</td>
            <td>${item.beads}</td>
            <td>${item.size/10}cm</td>
            <td>${item.price}</td>
            <td class="">
                <a href="#" class="" onclick="deleteCartItem(${index})">刪除</a>
            </td>
          </tr>
        `
        cartTotalPrice += item.price
      })
      document.querySelector("#cartList").innerHTML = str

      document.querySelector("#cartTotalPrice").innerHTML = cartTotalPrice
    } else {
      document.querySelector("#cartTable").classList.add("hidden")
      document.querySelector("#cartEmpty").classList.remove("hidden")
    }
  }


function deleteCartItem(num){
  let data = JSON.parse(localStorage.getItem("cart"))
  data.splice(num,1);
  localStorage.setItem("cart", JSON.stringify(data))
 
  renderCartData()
}

function clearCart(){
  localStorage.removeItem("cart")
  renderCartData()
}


const alertMsg = document.querySelectorAll("[data-message]");
const inputs = document.querySelectorAll("input[id]");

function addOrder(){
  alertMsg.forEach(function(item,index){
    if(inputs[index].value==""){
      item.textContent = `${item.dataset.message}必填`
      axios.post("http://localhost:3000/orders", obj)
      .then((res)=>{
        console.log(res)
      })
      .catch((err)=>{
        console.log(err)
      })
    }
  })
}

renderCartData()

</script>